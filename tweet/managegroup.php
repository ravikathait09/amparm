<?php
$fileBasePath = dirname(__FILE__).'/';include_once('include/header.php');include_once("inc/twitteroauth.php");$user=new User();$main= new Main();$settings = new Setting();if(!isset($_SESSION['user_info']['id'])){	header('Location: logout.php');	exit;}if(!isset($_SESSION['user_info']['id'])){	header('Location: logout.php');	exit;}if($_SESSION['user_info']['manage_group']!=1){	header('location:dashboard.php');}$userdetail=$user->findcustomrow(array('id'=>$_SESSION['user_info']['id'] ));$Group  = new Group();$screenname 		=$userdetail['screen_name'];$allgroup = $Group->getgroupbyowner($_SESSION['user_info']['id']); if(isset($_GET['delete'])){	   $Group->delete($_GET['id']);		$sql="delete from tweetuser where groupid='".$_GET['id']."'";		$main->runsql($sql);		$sql="delete from groupuser where groupid='".$_GET['id']."'";		$main->runsql($sql);			redirectAdmin('managegroup.php');		   }if(isset($_GET['groupid'])){		$groupid=$_GET['groupid'];	$groupdetail=$Group->findCustomRow(array('id'=>$groupid));}if(isset($_POST['groupid'])){	$Group = new Group();   $result=$Group->findCustomRow(array('title'=>$_POST['title']));   if(empty($result) || $_POST['title']==$groupdetail['title']){	   if(!empty($_FILES['icon']))	   {		   $source=$_FILES['icon']['tmp_name'];			$destination=rand().str_replace('','_',$_FILES['icon']['name']);		   if(move_uploaded_file($source,$config['DOC_ROOT'].'/img/'.$destination))			   $Group->icon=$destination;;
	   }	   $Group->groupjoinpoint = $_POST['groupjoin'];		$Group->autotweetpoint	 = $_POST['autotweet'];		$Group->afterschedulepoint	 = $_POST['tweetafterschedule'];		$Group->followerpoint=$_POST['followerpoint'];		$Group->id	 = $groupid;		$Group->title	 = $_POST['title'];		$Group->descripition	 = $_POST['desc'];		$Group->save();		$lastid=   $Group->lastInsertId();		$_SESSION['msgsuccess'] = "Group has been Edited successfully";   		redirectAdmin('managegroup.php');   }   else{		   $_SESSION['msgsuccess'] = "Group is already Exist";               			redirectAdmin('managegroup.php');   }}if(isset($_POST['saveCatg'])){   $result=$Group->findCustomRow(array('title'=>$_POST['title']));   if(empty($result)){	   if(!empty($_FILES['icon']))	   {		    $source=$_FILES['icon']['tmp_name'];			$destination=rand().str_replace('','_',$_FILES['icon']['name']);		    if(move_uploaded_file($source,$config['DOC_ROOT'].'/img/'.$destination))			$Group->icon=$destination;	   }	   $Group->icon=$destination;	   $Group->title	 = $_POST['title'];	   $Group->descripition	 = $_POST['desc'];	   $Group->created=date('Y-m-d h:i:s');	   $Group->clean_url=str_replace(' ','_',$_POST['title']);	   $Group->owner_id=$_SESSION['user_info']['id'];	   		$Group->groupjoinpoint = $_POST['groupjoin'];		$Group->autotweetpoint	 = $_POST['autotweet'];		$Group->afterschedulepoint	 = $_POST['tweetafterschedule'];		$Group->followerpoint=$_POST['followerpoint'];			   $Group->create();	   $lastid=   $Group->lastInsertId();	   $groupuser=new groupuser();	   $groupuser->groupid=$lastid;	  		$groupuser->userid=$_SESSION['user_info']['id'];		$groupuser->group_notification=1;		$groupuser->create();	   $_SESSION['msgsuccess'] = "Group has been added successfully";     		redirectAdmin('managegroup.php');   }   else{		   $_SESSION['msgsuccess'] = "Group is already Exist";               			redirectAdmin('addgroup.php');   }} $allSettings = $settings->findcustomRow(array('id'=>1));include('include/head.php');include('include/sidebar.php');
 ?><div id="content" class="page-content clearfix">	<div class="contentwrapper">
		<aside class="right-side">	<?php
		if(isset($_SESSION['msgsuccess'])){	?>			<div class="alert alert-success alert-dismissable">				<i class="fa fa-check"></i>				<button aria-hidden="true" data-dismiss="alert" class="close" type="button">x</button>				<b>Alert!</b> <?php echo $_SESSION['msgsuccess']; ?>.			</div>			<?php			unset($_SESSION['msgsuccess']);		}		?>
	 <div class="heading">			<h3>Manage Group</h3>		<div class="resBtnSearch">			<a href="#"><span class="s16 icomoon-icon-search-3"></span></a>		</div>				<ul class="breadcrumb">			<li>You are here:</li>			<li class="active">Group Management</li>		</ul>	</div>
    <section class="content">
       <div class="row">			<div class="col-md-12">						        <div class="box box-primary">                                <div class="box-header">                                    <h3 class="box-title">Add New Group</h3>                                </div>                                <form role="form" name="" id="" method="post" action="" enctype="multipart/form-data">									<div class="box-body">										<div class="form-group">											<label class="col-lg-2 col-md-3" for="exampleInputEmail1">Group Name</label>											<div class="col-lg-10 col-md-9">												<input type="text" placeholder="Enter Group Name" id="catName" name="title" class="form-control required" value='<?php if(isset($groupdetail['title'])) echo $groupdetail['title'] ?>' required>												<?php if(isset($groupid)){ ?>												<input type="hidden" value="<?php echo $groupid ;?>" name="groupid"/>												<?php } ?>											</div>										  </div>										 <div class="form-group">											<label class="col-lg-2 col-md-3 mt20" for="exampleInputEmail1">Group Description</label>											<div class="col-lg-10 col-md-9 mt20">												<textarea type="text" placeholder="Enter Group Description" id="catDesc" name="desc" class="form-control required" required><?php  if(isset($groupdetail['descripition']))  echo $groupdetail['descripition'] ?></textarea>											</div>										  </div>										  <div class="form-group">											<label class="col-lg-2 col-md-3 mt20" for="exampleInputEmail1">Group Image</label>											<div class="col-lg-10 col-md-9 mt20">												<input type="file" name="icon" class="form-control required"/></div>										  </div>										   <div class="form-group">											<label class="col-lg-2 col-md-3 mt20" for="exampleInputEmail1">Group Join Point</label>												<div class="col-lg-10 col-md-9 mt20">													<input type="text" placeholder="Enter Group Join Point" id="first_name" name="groupjoin" class="form-control required" value="<?php if(isset($groupdetail['groupjoinpoint'])) echo  $groupdetail['groupjoinpoint'] ;else  //echo $allSettings['groupjoin']; ?>" required>												</div>										  </div>										    <div class="form-group">											<label class="col-lg-2 col-md-3 mt20" for="exampleInputEmail1">Tweet Point Before Schedule date </label>												<div class="col-lg-10 col-md-9 mt20">													<input type="text" placeholder="Enter Autotweet" id="autotweet" name="autotweet" class="form-control required" value="<?php if(isset($groupdetail['autotweetpoint'])) echo  $groupdetail['autotweetpoint'] ;else //echo $allSettings['autotweet']; ?>" required>												</div>											</div>											<div style="clear:both"></div>										 <div class="form-group">											<label class="col-lg-2 col-md-3 mt20" for="exampleInputEmail1">Tweet Point after Schedule date </label>												<div class="col-lg-10 col-md-9 mt20">													<input type="text" required=""  class="form-control required" name="tweetafterschedule" id="tweetafterschedule" placeholder="Enter Tweet Point After Scheduled date"  value="<?php if(isset($groupdetail['afterschedulepoint'])) echo  $groupdetail['afterschedulepoint'] ;else //echo $allSettings['tweetafterschedule']; ?>">												</div>											</div>											<div style="clear:both"></div>										<div class="form-group">											<label class="col-lg-2 col-md-3 mt20" for="exampleInputEmail1">Tweet Point on Tweet Follower </label>												<div class="col-lg-10 col-md-9 mt20">													<input type="text" required=""  value="<?php if(isset($groupdetail['followerpoint'])) echo  $groupdetail['followerpoint'] ;else //echo $allSettings['followerpoint']; ?>" class="form-control required" name="followerpoint" id="followerpoint" placeholder="Follower Point ">												</div>											</div>                                     </div>                                    <div class="box-footer">									 <div class="col-lg-2 col-md-3 mt20"></div>									 <div class="col-lg-10 col-md-9 mt20">                                        <button class="btn btn-primary" type="submit" name="saveCatg">Submit</button>									 </div>                                    </div>                                </form>                            </div><!-- /.box-body -->					</div>			<div class="col-md-12">				<div class="box box-primary">					<div class="box-header"></div><!-- /.box-header -->						<div class="box-body">						<table class="table table-bordered" id="userTable">							<thead>								<tr> 									<th style="width: 10px">#</th>                                    <th>Name</th>									<!--<th>Group Desc</th>-->									<th>Group Url</th>									<th>Group Member</th>									<th>Group Admin</th>									<th>Approve/Group Reached</th>									<th>Action</th>								</tr>							</thead>							<tbody>							<?php $i=0; foreach($allgroup as $k=>$groupdata){  $i++;							$groupuser=new groupuser();							 $sql="select sum(u.follower) as reach from users u,groupuser g where g.groupid='".$groupdata['id']."' and u.id=g.userid";							$totalcount=$main->runsql($sql);							$sql="select sum(u.follower) as reach from users u,groupuser g where g.groupid='".$groupdata['id']."' and u.id=g.userid and g.group_notification=1";							$estimatecount=$main->runsql($sql);							#print_R($totalcount);																												$totaluser=$groupuser->countWhere('userid','groupid='.$groupdata['id']);							$approveuser=$groupuser->countWhere('userid','groupid='.$groupdata['id']. ' and group_notification=1');							?>
						
						<tr>
							<td><?php echo $i; ?></td>
							<td><?php echo $groupdata['title']; ?></td>
							<!--<td><?php echo $groupdata['descripition']; ?></td>-->							<td><?php echo $config['SITE_URL'].'?clean_url='.$groupdata['clean_url']; ?></td>							<td><?php echo $approveuser.'/'.$totaluser; ?></td>
							
							<td><?php echo $groupdata['firstname'];  ?></td>							<td><?php echo $totalcount[0]['reach'].'/'.$estimatecount[0]['reach'];  ?></td>
							<td>
								<a class="" href="<?php echo $config['SITE_URL']."managegroup.php?groupid=".$groupdata['id'];?>"><i class="fa fa-edit"></i></a>
								&nbsp;&nbsp;								<a title="Delete Group"  class=" " onclick="return confirm('Are you sure?');" href="<?php echo $config['SITE_URL']."managegroup.php?delete=1&id=".$groupdata['id'];?>"><i class="icomoon-icon-remove-4" aria-hidden="true"></i></a>
								<a title="view Group Member"  class="" href="<?php echo $config['SITE_URL']."userlist.php?TYPE=GROUP&id=".$groupdata['id'];?>"><i class="eco-users" aria-hidden="true"></i></a>
								
							</td>                                                                        
						</tr>                                                                                
						<?php
						}
					?>
                                    </tbody>
									</table>
                                    </div><!-- /.box-body -->
                            </div><!-- /.box -->
                    </div>   					
                </section><!-- /.content -->
				</aside></div></div>
<?php include('include/footer.php'); 	?>